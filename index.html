<html>
<head>
	<title>CoS test</title>
	<link href="jquery-ui/css/smoothness/jquery-ui-1.8.20.custom.css" rel="stylesheet" type="text/css"/>
	<style type="text/css">
	* {
		font-family: sans-serif;
	}
	label {
		font-weight: bold;
	}
	#assessmentDialog > div {
		margin-bottom: 1em;
	}
	#circles {
		float: left;
		width: 50%;
	}
	#control-panel {
		float: right;
		width: 50%;
	}
	.ui-slider {
		border: none;
		left: 0px;
	}
	.ui-slider .ui-slider-handle { 
     position: absolute;
      cursor: hand;
      width: 27px;
      left: 0px;
      margin-left: 0px;
	}
	#slider {
    width: 300px;
	}
	#scale-value {
	}
	.scale-item {
		width: 11%;
		height: 15px;
		float: left;
	}
	#vibrant {
		background-color: #00A651;
	}
	#good {
		background-color: #39B44A;
	}
	#highly-satisfactory {
		background-color: #8DC63F;
	}
	#satisfactory-plus {
		background-color: #CBDB2A;
	}
	#satisfactory {
		background-color: #FFF200;
	}
	#satisfactory-minus {
		background-color: #FFC20E;
	}
	#highly-unsatisfactory {
		background-color: #F7941E;
	}
	#bad {
		background-color: #F26522;
	}
	#critical {
		background-color: #ED1C24;
	}
	</style>
	<script type="text/javascript" language="javascript" src="jquery-ui/js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" language="javascript" src="jquery-ui/js/jquery-ui-1.8.20.custom.min.js"></script>
	<script src="assessment.js" type="text/javascript"></script>
  <script type="text/javascript" language="javascript">

  // Declare global variable
  var assessment, canvas;
   var numCircles = 9;

	$(document).ready(function() {
		// Get the canvas
	   canvas = $("#assessmentCanvas")[0];
	   var ctx = canvas.getContext('2d');


		 // Setup random data
		 var values = new Array();
	    for (var i = 0; i < 4; i++) {
	        var domainValues = new Array();
	        for (var j = 0; j < 7; j++) {
	        	var extent = Math.ceil(Math.random() * numCircles);
	        	domainValues.push(extent);
	        }
	        values.push(domainValues);
	    }

	   // Create the Assessment
		 assessment = new CoS.Assessment(ctx, { 
		 	width: 600, 
		 	height: 600,
		 	values:  values,
		 	numCircles: numCircles,
		 	radiusProportion: 0.75,
		 	font: "bold 30px sans-serif",
		 	rotation: 0
		 });

	   assessment.drawAssessmentCircle();

	    // Create the slider
	    var currentVal = Math.ceil(numCircles / 2);
	   $('#assessSlider').slider({ 
	   		min: 1, max: 12, value: Math.ceil(numCircles / 2), step: 1,
	   		slide: function(event, ui) {
        	$("#slider-value").html(getRatingText(ui.value));
    		}
	   	});

	   // Event handling
	   addHandler();
	});

	var getRatingText = function(val) {
			var displayText;
			switch (val) {
				case 1:
					displayText = "Critical";
					break;
				case 2:
					displayText = "Bad";
					break;
				case 3:
					displayText = "Highly Unsatisfactory";
					break;
				case 4:
					displayText = "Satisfactory-";
					break;
				case 5:
					displayText = "Satisfactory";
					break;
				case 6:
					displayText = "Satisfactory+";
					break;
				case 7:
					displayText = "Highly Satisfactory";
					break;
				case 8:
					displayText = "Good";
					break;
				case 9:
					displayText = "Vibrant";
					break;
			}
			return displayText;
	}

	function addHandler() {
	    canvas.addEventListener('click', function(e){
	        var point = determinePoint(e);
	        assessment.findSegment(point.x, point.y, updateSegment);
	    });
	    canvas.addEventListener('mousemove', function(e){
	        var point = determinePoint(e);
	        assessment.findSegment(point.x, point.y, showSubdomain);
	    });
	}

	var determinePoint = function(e) {
			e = $.event.fix(e || window.event);
	    return {x: e.offsetX, y: e.offsetY};
	}

	var updateSegment = function(domainId, domainName, subdomainId, subdomainName, oldValue, newValue) {
	    if ($('#showDialog').is(':checked')) {
	        showAssessmentDialog(domainId, domainName, subdomainId, subdomainName, oldValue, newValue);
	    }
	    else {
	        drawSegment(domainId, domainName, subdomainId, subdomainName, oldValue, newValue);
	    }
	}

	var showAssessmentDialog = function (domainId, domainName, subdomainId, subdomainName, oldValue, newValue) {
	    $('#assessDomain').html(domainName);
	    $('#assessSubdomain').html(subdomainName);
	     $('#assessmentDialog').dialog({
	         autoOpen: false,
	         buttons: {
	             "OK": function() {
	                 var val = ($('#assessSlider').slider( "option", "value" ));
	                 if (val > 9)
	                 		val = 9;
	                 $(this).dialog('close');
	                 drawSegment(domainId, domainName, subdomainId, subdomainName, oldValue, val);
	             },
	             "Cancel": function() {
	                 $(this).dialog('close');
	             }
	         }
	     });
      $('#assessSlider').slider({ min: 1, max: numCircles + 1, value: oldValue, step: 1 });
	   $("#slider-value").html(getRatingText(oldValue));

	    $('#assessmentDialog').dialog('open');
	}

	var drawSegment = function drawSegment(domainId, domainName, subdomainId, subdomainName, oldValue, newValue) {
	   // saveAssessment(extent);
	   assessment.updateCircleSegment(domainId, subdomainId, newValue);
	}

	var showSubdomain = function showSubdomain(domainId, domainName, subdomainId, subdomainName, oldValue, newValue) {
		$("#tooltip").html(domainName + ": " + subdomainName);
	}

</script>

</head>
<body>

	<div>
		<div id="circles">
	    <canvas id="assessmentCanvas" width="600" height="600" ></canvas>
		</div>
		<div id="control-panel">
			<div>
			  Show dialog<input type="checkbox" id="showDialog" name="showDialog" checked="checked"> 
			</div>
			  <div id="tooltip"></div>
		</div>
	</div>

	<div id="assessmentDialog" style="display: none;">
	    <div>
	        <label for="assessDomain">Domain: </label>
	        <span id="assessDomain"></span>
	    </div>
	    <div>
	        <label for="assessSubdomain">Subdomain: </label>
	        <span id="assessSubdomain"></span>
	    </div>
	    <div>Rate how sustainable you think your project is against this subdomain, on a scale of 1 (least sustainable) to 9 (most sustainable):</div>
	    <div id="assessSlider">
	    	<div class="scale-item" id="critical"></div>
	    	<div class="scale-item" id="bad"></div>
	    	<div class="scale-item" id="highly-unsatisfactory"></div>
	    	<div class="scale-item" id="satisfactory-minus"></div>
	    	<div class="scale-item" id="satisfactory"></div>
	    	<div class="scale-item" id="satisfactory-plus"></div>
	    	<div class="scale-item" id="highly-satisfactory"></div>
	    	<div class="scale-item" id="good"></div>
	    	<div class="scale-item" id="vibrant"></div>
	    	<div class="ui-slider-handle"></div> 
	    </div>
	    <div id="slider-value">
	    </div>
	</div>

</body>
</html>